# Поддержка «табличных» форматов

YaLedger на настоящий момент поддерживает чтение транзакций из файлов
[CSV][] и [HTML][]. Т.к. конкретный формат записей в таблицах бывает
разным, конкретный формат должен быть описан в конфиге (по умолчанию —
`~/.config/yaledger/$format.yaml`). Общими для всех «табличных» форматов
являются следующие параметры:

-   dateformat. Формат даты/времени. По умолчанию “YYYY/MM/DD”. Может
    быть, например, “DD/MM/YYYY” или “DD.MM”.
-   filter. Фильтр строк. Определяет, какие строки таблицы должны
    читаться. Задаётся в виде списка, каждый элемент которого имеет
    параметры:
    -   field. Номер проверяемого стоблца таблицы (считая от 1). По
        умолчанию — 1.
    -   regexp. Регулярное выражение, которому должно соответствовать
        содержимое столбца, чтобы запись была учтена. Обязательный
        параметр. Запись учитывается только если выполнены все условия.

-   Остальные параметры определяют, откуда брать различные параметры
    создаваемых транзакций. Имя параметра соответствует параметру
    транзакции. Следующие параметры имеют особый смысл:
    -   date. Дата транзакции.
    -   currency. Валюта сумм.
    -   amount. Сумма транзакции.
    -   account. Счёт, к которому относится сумма в таблице. Если сумма
        положительная, то этот счёт кредитуется, иначе — дебетуется.
    -   account2. Корреспондирующий счёт. Сумма по нему будет рассчитана
        автоматически. Если параметр не указан, то корреспондирующий
        счёт будет выбираться автоматически.
    -   hold. Если "yes" — запись будет использовать холд. Если "try" — запись будет пытаться использовать холд.
    -   Остальные параметры определяют значения пользовательских
        атрибутов транзакции.

Каждый из параметров транзакции может быть задан в виде фиксированной
строки (например, `{currency: "$"}`). Иначе следующие параметры
определяют, откуда брать значение:

* field. Номер столбца таблицы, начиная с 1.
* regexp. Регулярное выражение, выделяющее нужную часть содержимого
ячейки. Если не задано, то используется всё содержимое ячейки.
* optional: true/false. Если true, то значение атрибута будет
необязательным. Используется только для пользовательских атрибутов
транзакции.
* rules.Если не задан, то параметр транзакции равен содержимому ячейки
(или тому, что выделило регулярное выражение). Иначе задаётся словарь,
каждый ключ которого — возможное значение параметра транзакции, а
значение — регулярное выражение, которому должно соответствовать
содержимое ячейки. Если содержимое ячейки не соответствует ни одному из регулярных выражений, то используется значение, соответствующее ключу `default` в этом словаре.

Пример:

~~~ { .yaml }
account2:
  # Использовать третий столбец таблицы
  field: 3
  rules:
    магинфо: "ИНТЕРНЕТ"
    премия: "премия"
    зарплата: "Заработная плата"
    аванс: "Аванс"
    наличные: "Выдача наличных"
    банковские_комиссии: "(Комиссия)|(Плата за .*обслуживание)"
    "интернет/МТС": "МТС модем"
    default: разное
~~~

[CSV]: CSV.md
[HTML]: HTML.md
